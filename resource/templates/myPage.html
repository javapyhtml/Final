<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>KeePet - Premium Pet Sitter</title>

    <link href="/css/myPage.css" rel="stylesheet">
    <link rel="shortcut icon" href="/images/favicon.ico">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>
<body>

<div class="main-container">
    <!-- ì‚¬ì´ë“œë°” -->
    <div class="sidebar">
        <div id="logo"><a href="/"><img src="/images/logo.png" width="110" height="50" alt="logo"></a></div>
        <div class="profile-image" id="pImage">
            <img alt="í”„ë¡œí•„ ì‚¬ì§„" th:src="@{/profile/{loginProfile}(loginProfile=${session.loginProfile})}">
        </div>
        <br>
        <button class="tab-button active" data-tab="tab1">ë‚´ ì •ë³´</button>
        <button class="tab-button" data-tab="tab2" id="petTab">ë§ˆì´í« ì •ë³´</button>
        <button class="tab-button" data-tab="tab3">ë‚´ ì‹ ì²­ ë‚´ì—­</button>
        <button class="tab-button" data-tab="tab4">ë‚´ ë¦¬ë·°</button>
        <button class="tab-button" data-tab="tab5">í‚µí« ëŒë´„ ì¼ì§€</button>
    </div>

    <!-- ì½˜í…ì¸  ì˜ì—­ -->
    <div class="content-area">
        <!-- ë‚´ ì •ë³´ -->
        <div class="tab-content active" id="tab1">
            <div class="profile-container">
                <h2>ë‚´ ì •ë³´</h2>
                <div class="personal-info-area">
                    <div class="profile-details">
                        <p>ì´ë¦„: <span th:text="${session.loginName}"></span></p>
                        <p>ë‹‰ë„¤ì„: <span th:text="${session.loginNickname}"></span></p>
                        <p>ìƒë…„ì›”ì¼: <span th:text="${session.loginBirth}"></span></p>
                        <p>ì´ë©”ì¼: <span th:text="${session.loginEmail}"></span></p>
                        <p>ì—°ë½ì²˜: <span th:text="${session.loginPhone}"></span></p>
                        <p>ì£¼ì†Œ: <span th:text="${session.loginAddress}"></span></p>
                    </div>
                    <div class="action-buttons">
                        <button id="editProfileBtn">ìˆ˜ì •</button>
                        <button id="deleteUserBtn">íƒˆí‡´</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal-overlay" style="display: none;"></div>
        <div class="modal" id="modifyModal" style="display: none; width: 500px; height: 800px">
            <div class="modal-content">
                <span class="close-btn" id="closeModifyModal">Ã—</span>
                <div class="modal-body">
                    <h2>íšŒì› ì •ë³´ ìˆ˜ì •</h2>
                    <form action="/mdJoin" enctype="multipart/form-data" method="post" name="mJoinForm" id="modifyForm" style="height: 80%; margin: 50px 0;">
                        <table style="margin: auto 0; border: none; gap: 30px;" id="modifyTable">
                            <tr>
                                <th>ì•„ì´ë””</th>
                                <td>
                                    <input id="User_Id" name="UserId" readonly th:value="${session.loginId}" style="border: none;"
                                           type="text"/>

                                </td>
                            </tr>
                            <tr>
                                <th>ë¹„ë°€ë²ˆí˜¸</th>
                                <td>
                                    <input id="User_Pw" name="UserPw" placeholder="ë¹„ë°€ë²ˆí˜¸" type="password"/>
                                    <p id="check2"></p>
                                </td>
                            </tr>
                            <tr>
                                <th>ë¹„ë°€ë²ˆí˜¸ í™•ì¸</th>
                                <td>
                                    <input id="checkPw" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" type="password"/>
                                    <p id="check3"></p>
                                </td>
                            </tr>
                            <tr>
                                <th>ìƒë…„ì›”ì¼</th>
                                <td th:text="${session.loginBirth}"></td>
                                <td><input id="User_Birth" name="UserBirth" placeholder="ìƒë…„ì›”ì¼"
                                           th:value="${session.loginBirth}"
                                           type="hidden"/></td>
                            </tr>
                            <tr>
                                <th>ì´ë©”ì¼</th>
                                <td>
                                    <input id="User_Email" name="UserEmail" placeholder="ì´ë©”ì¼"
                                           th:value="${session.loginEmail}"
                                           type="email"/>
                                    <span id="check4">
                            <input id="checkEmail" type="button" value="ì¸ì¦"/>
                        </span>
                                </td>
                            </tr>
                            <tr>
                                <th>ì—°ë½ì²˜</th>
                                <td>
                                    <input id="User_Phone" name="UserPhone" placeholder="ì—°ë½ì²˜"
                                           th:value="${session.loginPhone}"
                                           type="text"/>
                                    <span id="check5">
                            <input id="checkPhone" type="button" value="ì¸ì¦"/>
                        </span>
                                </td>
                            </tr>
                            <tr>
                                <th>ì£¼ì†Œ</th>
                                <td>
                                    <input onclick="sample6_execDaumPostcode_modal()" type="button" value="ìš°í¸ë²ˆí˜¸ ì°¾ê¸°"><br>
                                    <input id="modal_sample6_address" placeholder="ì£¼ì†Œ"
                                           th:value="${session.loginAddress}"
                                           type="text"><br>
                                    <!--                            <input id="modal_sample6_detailAddress" placeholder="ìƒì„¸ì£¼ì†Œ" type="text">-->
                                    <input id="User_Address" name="UserAddress" type="hidden"/>
                                </td>
                            </tr>
                            <tr>
                                <th>ì´ë¦„</th>
                                <td><input name="UserName" placeholder="ì´ë¦„" th:value="${session.loginName}"
                                           type="text"/></td>
                            </tr>
                            <tr>
                                <th>ë‹‰ë„¤ì„</th>
                                <td><input name="UserNickname" placeholder="ë‹‰ë„¤ì„" th:value="${session.loginNickname}"
                                           type="text"/></td>
                            </tr>
                            <tr>
                                <th>í”„ë¡œí•„ì‚¬ì§„</th>
                                <td><input id="User_Profile" name="UserProfile" type="file"/>
                                    <br/><img id="preImage"
                                              th:src="@{/Profile/${session.loginProfile ?: 'default.png'}}"
                                              width="100px"/></td>
                            </tr>
                        </table>
                        <div class="edit-profile-actions">
                            <button id="modalSaveBtn" type="submit">ìˆ˜ì •</button>
                            <button id="modalCancelBtn" type="button">ì·¨ì†Œ</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- ë‚´ ë°˜ë ¤ê²¬ ì •ë³´ -->
        <div class="tab-content" id="tab2">
            <div class="profile-container">
                <h2>ë‚´ ë°˜ë ¤ê²¬ ì •ë³´</h2>
                <div id="petInfo">

                </div>
            </div>
        </div>

        <!-- ë‚´ ì‹ ì²­ ë‚´ì—­ -->
        <div class="tab-content" id="tab3">
            <h4>ë‚´ ì‹ ì²­ ë‚´ì—­</h4>

            <!-- ê°€ë¡œ ì •ë ¬ì„ ìœ„í•œ ì»¨í…Œì´ë„ˆ -->
            <div class="table-container">
                <!-- ì²« ë²ˆì§¸ í…Œì´ë¸” -->
                <table class="board-table">
                    <thead>
                    <tr>
                        <th>ì‹ ì²­ê¸€</th>
                        <th>ì˜ˆì•½ë‚ ì§œ</th>
                        <th>ë¦¬ë·°ì‘ì„±</th>
                    </tr>
                    </thead>
                    <tbody id="written-post-list">
                    <!-- JavaScriptì—ì„œ ë°ì´í„° ì¶”ê°€ -->
                    </tbody>
                </table>

                <!-- ë‘ ë²ˆì§¸ í…Œì´ë¸” -->
                <table class="board-table">
                    <thead>
                    <tr>
                        <th>í”½ì—…ê¸€</th>
                        <th>ì½”ìŠ¤í™•ì¸</th>
                    </tr>
                    </thead>
                    <tbody id="apply-list">
                    <!-- JavaScriptì—ì„œ ë°ì´í„° ì¶”ê°€ -->
                    </tbody>
                </table>
            </div>
        </div>


        <!-- ë¦¬ë·° ì‘ì„± ëª¨ë‹¬ -->
        <div class="modal" id="reviewModal" style="display: none;">
            <div class="modal-content">
                <span class="close-btn" id="closeModal">&times;</span>
                <h3>ë¦¬ë·° ì‘ì„±</h3>
                <form action="/RWrite" enctype="multipart/form-data" id="reviewForm" method="post"
                      name="RWriteForm">
                    <!--                    <input type="hidden" name="BNum" th:value="${bNum}"/>-->
                    <!--                    <input type="hidden" name="UserId" th:value="${session.loginId}"/>-->
                    <input id="BNum" name="BNum" type="hidden" value=""/>
                    <input id="UserId" name="UserId" type="hidden" value=""/>

                    <div>
                        <label for="revContents">ë¦¬ë·° ë‚´ìš©:</label>
                        <textarea id="revContents" name="RevContents" required rows="4"></textarea>
                    </div>
                    <div>
                        <label for="ratingStars">ë³„ì :</label>
                        <div class="stars" id="ratingStars">
                            <i class="fa fa-star" data-value="1"></i>
                            <i class="fa fa-star" data-value="2"></i>
                            <i class="fa fa-star" data-value="3"></i>
                            <i class="fa fa-star" data-value="4"></i>
                            <i class="fa fa-star" data-value="5"></i>
                        </div>
                        <input id="ratingValue" name="Rating" type="hidden" value="0"/>
                    </div>
                    <div>
                        <label for="revFile">í›„ê¸° íŒŒì¼ ì²¨ë¶€:</label>
                        <input id="revFile" name="revFile"type="file"/>
                        <br/> <img id="revImage" width="150px"/>
                    </div>
                    <div>
                        <button type="submit">ì‘ì„±ì™„ë£Œ</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ë‚´ ë¦¬ë·° -->
        <div class="tab-content" id="tab4">
            <h4>ë‚´ ë¦¬ë·°</h4>
            <table class="review-table">
                <thead>
                <tr>
                    <th>ì‹ ì²­ê¸€ ì œëª©</th>
                    <th>ë‚´ìš©</th>
                    <th>ë³„ì </th>
                    <th>ì‹ ì²­ê¸€ ë³´ê¸°</th>
                </tr>
                </thead>
                <tbody id="myreview-list">

                </tbody>
            </table>
        </div>

        <!-- í‚µí« ëŒë´„ ì¼ì§€ -->
        <div class="tab-content" id="tab5">
            <h4>í‚µí« ëŒë´„ ì¼ì§€</h4>
            <input type="hidden" id="userIdcheck" th:value="${session.loginId}" />

            <div id="diary-list"></div>
        </div>

        <div class="modal-overlay" id="modalOverlay" style="display: none;"></div>

        <!-- ëŒë´„ ì¼ì§€ ëª¨ë‹¬ -->
        <div id="careDiaryModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close-btn" id="closeDiaryyModal">Ã—</span>
                <h4 id="modal-title"></h4>

                <div class="modal-body">
                    <input type="hidden" id="userIdcheck1" th:value="${session.loginId}" />
                    <div class="modal-scroll"> <!-- ìŠ¤í¬ë¡¤ì´ í•„ìš”í•œ ë¶€ë¶„ì„ ê°ì‹¸ëŠ” div ì¶”ê°€ -->
                        <table class="diary-table">
                            <tbody class="care-list"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



        <script crossorigin="anonymous" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
        src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script th:inline="javascript">
    window.onload = function () {
        // ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ ì„¸ì…˜ ì´ë¯¸ì§€ ê²½ë¡œ(ìƒëŒ€ ê²½ë¡œ ìœ ì§€)
        var profileImageUrl = '[[${session.loginProfile}]]';  // ì„¸ì…˜ì—ì„œ íŒŒì¼ëª…ë§Œ ê°€ì ¸ì˜´
        if (profileImageUrl) {
            // Thymeleafì—ì„œ ì‚¬ìš©í•˜ëŠ” ê²½ë¡œì™€ ì¼ì¹˜ì‹œì¼œ ì›¹ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê²½ë¡œë¡œ ë³€ê²½
            document.getElementById('preImage').src = '/images/Profile/' + profileImageUrl;
        }
    };
    $('#User_Profile').on('change', function (event) {
        let file = event.target.files[0];  // ì„ íƒí•œ íŒŒì¼
        console.log(file);  // íŒŒì¼ ê°ì²´ê°€ ì˜ ì½í˜”ëŠ”ì§€ í™•ì¸
        if (file) {
            let reader = new FileReader();  // FileReader ìƒì„±

            reader.onload = function (e) {
                console.log(e.target.result);  // ì½íŒ íŒŒì¼ì˜ URLì„ ì½˜ì†”ë¡œ ì¶œë ¥í•˜ì—¬ í™•ì¸
                $('#preImage').attr('src', e.target.result);  // ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€
            };

            // íŒŒì¼ì„ Base64 ë°ì´í„° URLë¡œ ë³€í™˜
            reader.readAsDataURL(file);  // FileReaderê°€ Base64ë¡œ ë³€í™˜
        } else {
            console.log('íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
        }
    });

    // íšŒì›íƒˆí‡´ ë²„íŠ¼ í´ë¦­ ì‹œ
    document.getElementById('deleteUserBtn').addEventListener('click', function() {
        // ì‚¬ìš©ìê°€ íƒˆí‡´ë¥¼ í™•ì‹¤íˆ í•˜ê¸¸ ì›í•œë‹¤ë©´ í™•ì¸ì°½ì„ ë„ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        const confirmDelete = confirm('ì •ë§ë¡œ íšŒì›íƒˆí‡´ë¥¼ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');

        // ì‚¬ìš©ìê°€ 'í™•ì¸'ì„ ëˆŒë €ì„ ë•Œë§Œ íƒˆí‡´ í˜ì´ì§€ë¡œ ì´ë™
        if (confirmDelete) {
            // '/deleteUser' í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = '/deleteUser';
        }
    });


    // ìˆ˜ì • í¼ JavaScript
    const editProfileForm = document.querySelector('.edit-profile-form');
    const editProfileBtn = document.getElementById('editProfileBtn');
    const personalInfoArea = document.querySelector('.personal-info-area');
    const sidebar = document.querySelector('.sidebar');
    const tab1Content = document.getElementById('tab1'); // "ë‚´ ì •ë³´ ë‚´ì—­" íƒ­ ë‚´ìš©
    const modalCancelBtn = document.getElementById('modalCancelBtn');
    const modalSaveBtn = document.getElementById('modalSaveBtn');

    editProfileBtn.onclick = function () {
        // ìˆ˜ì • í¼ ë³´ì´ê¸°
        personalInfoArea.classList.add('hidden');
        sidebar.classList.add('hidden');
        tab1Content.classList.add('hidden');
        editProfileForm.classList.remove('hidden');
    }

    modalCancelBtn.onclick = function () {
        // ìˆ˜ì • í¼ ìˆ¨ê¸°ê¸°, ì›ë˜ í™”ë©´ ë³´ì´ê¸°
        editProfileForm.classList.add('hidden');
        personalInfoArea.classList.remove('hidden');
        sidebar.classList.remove('hidden');
        tab1Content.classList.remove('hidden');
    }

    modalSaveBtn.onclick = function () {
        // ì—¬ê¸°ì— ì €ì¥ ë¡œì§ì„ êµ¬í˜„í•˜ì„¸ìš”
        alert("ìˆ˜ì • ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"); // ì˜ˆì‹œ
        editProfileForm.classList.add('hidden');
        personalInfoArea.classList.remove('hidden');
        sidebar.classList.remove('hidden');
        tab1Content.classList.remove('hidden');
    }



    // í”„ë¡œí•„ ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° (Modal ë‚´ë¶€ -> í¼ ë‚´ë¶€)
    document.querySelector('#User_Profile').onchange = function (event) {
        let file = event.target.files[0];
        if (file) {
            let reader = new FileReader();
            reader.onload = function (e) {
                document.querySelector('#preImage').src = e.target.result;
            }
            reader.readAsDataURL(file);
        }
    };

    // ë‹¤ìŒ ì£¼ì†Œ API (Modal ë‚´ë¶€ -> í¼ ë‚´ë¶€)
    function sample6_execDaumPostcode_modal() {
        new daum.Postcode({
            oncomplete: function (data) {
                var addr = '';
                if (data.userSelectedType === 'R') {
                    addr = data.roadAddress;
                } else {
                    addr = data.jibunAddress;
                }

                // ë„ë¡œëª… ì£¼ì†Œì— "ì¸ì²œ"ì´ í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ ì²´í¬
                if (addr.indexOf("ì¸ì²œ") === -1) {
                    alert("ì¸ì²œì— í•´ë‹¹í•˜ëŠ” ì£¼ì†Œë§Œ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
                    return; // "ì¸ì²œ"ì´ í¬í•¨ë˜ì§€ ì•Šì€ ì£¼ì†ŒëŠ” ê²€ìƒ‰ ì¢…ë£Œ
                }

                document.querySelector('#modal_sample6_address').value = addr;
                // document.querySelector('#modal_sample6_detailAddress').focus();
                console.log("ì„ íƒëœ ì£¼ì†Œ:", addr);
            }
        }).open();
    }

    // ì£¼ì†Œ í•©ì¹˜ê¸° ë° Form ì œì¶œ (Modal ë‚´ë¶€ -> í¼ ë‚´ë¶€)
    document.querySelector('#modalSaveBtn').onclick = function () {
        let user_Address = document.querySelector('#User_Address');
        let addr1 = document.querySelector('#modal_sample6_address').value;
        console.log("ì£¼ì†Œ ê°’:", addr1);  // addr1 ê°’ í™•ì¸
        // let addr2 = document.querySelector('#modal_sample6_detailAddress').value;

        user_Address.value = `${addr1}`;

        // ê°„ë‹¨í•œ ìœ íš¨ì„± ê²€ì‚¬ (ì¶”ê°€ì ì¸ ê²€ì¦ ë¡œì§ í•„ìš”)
        if (!document.querySelector('#User_Pw').value || !document.querySelector('#checkPw').value || !document.querySelector('#User_Email').value || !document.querySelector('#User_Phone').value) {
            alert('í•„ìˆ˜ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        document.querySelector('form[name="mJoinForm"]').submit();
        alert('ìˆ˜ì • ì™„ë£Œ! íšŒì› ì •ë³´ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•´ ë‹¤ì‹œ ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.');
    };


    let user_Pw = $('#User_Pw');
    let check2 = $('#check2');
    let check_pw1 = false;

    user_Pw.keyup(() => {
        let pwVal = user_Pw.val();
        let num = pwVal.search(/[0-9]/);
        let eng = pwVal.search(/[a-z]/);
        let eng1 = pwVal.search(/[A-Z]/);
        let spe = pwVal.search(/[~!@#$%^&*]/);
        let spc = pwVal.search(/\s/);
        let checked = pwVal.search(/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[~!@#$%^&*])[\S]{8,16}$/);

        if (pwVal.length < 8 || pwVal.length > 16) {
            check2.html('8-16ìë¦¬ ì…ë ¥!');
            check2.css('color', 'red');
            check_pw1 = false;
        } else if (spc != -1) {
            check2.html('ê³µë°±ì—†ì´ ì…ë ¥!');
            check2.css('color', 'red');
            check_pw1 = false;
        } else if (num == -1 || eng == -1 || eng1 == -1 || spe == -1) {
            check2.html('ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì, ëŒ€ì†Œë¬¸ì í˜¼í•© ì…ë ¥!');
            check2.css('color', 'red');
            check_pw1 = false;
        } else {
            check2.html('ì‚¬ìš©ê°€ëŠ¥í•œ ë¹„ë°€ë²ˆí˜¸!');
            check2.css('color', 'blue');
            check_pw1 = true;
        }
    });

    let checkPw = $('#checkPw');
    let check3 = $('#check3');
    let check_pw2 = false;

    checkPw.keyup(() => {
        pwVal = user_Pw.val();
        let checkVal = checkPw.val();

        if (pwVal == checkVal) {
            check3.html(`ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜`);
            check3.css('color', 'blue');
            check_pw2 = true;
        } else {
            check3.html(`ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜`);
            check3.css('color', 'red');
            check_pw2 = false;
        }
    });

    let checkEmail = $('#checkEmail');
    let user_Email = $('#User_Email');
    let check4 = $('#check4');
    let check_email = false;

    checkEmail.click(() => {
        $.ajax({
            type: "POST",
            url: "/emailCheck",
            data: {"UserEmail": user_Email.val()},
            dataType: "text",
            success: (uuid) => {
                console.log(uuid);
                check4.empty();
                check4.append(`<br/><input type="text" id="uuid1" />`);
                check4.append(` <input type="button" value="ì¸ì¦" id="btnUUID" data-value="${uuid}" />`);
            },
            error: () => {
                alert('emailCheck í†µì‹  ì‹¤íŒ¨');
            }
        });
    });

    $(document).on('click', '#btnUUID', function () {
        let uuid = $(this).data("value");
        let uuid1 = $('#uuid1').val();

        if (uuid == uuid1) {
            alert('ì´ë©”ì¼ ì¸ì¦ ì„±ê³µ');
            check4.hide();
            user_Email.attr('readonly', true);
            check_email = true;
        } else {
            alert('ì´ë©”ì¼ ì¸ì¦ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”');
            $('#uuid1').val("");
            check_email = false;
        }
    });

    let check_phone = false;

    $(document).on('click', '#checkPhone', function () {
        var phone = $('#User_Phone').val();

        if (phone === "") {
            alert("ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        } else {
            alert("ì…ë ¥í•˜ì‹  í° ë²ˆí˜¸ëŠ” : " + phone + "ì…ë‹ˆë‹¤.");
        }

        $.ajax({
            url: '/PhoneCheck',
            method: 'POST',
            data: {"UserPhone": phone},
            dataType: "text",
            success: function (response) {
                console.log("ì—°ë½ì²˜:", phone, "ì¸ì¦ë²ˆí˜¸:", response);
                var check5 = $('#check5');
                check5.empty();
                check5.append(`<br/><input type="text" id="uuid" />`);
                check5.append(` <input type="button" value="ì¸ì¦" id="BtnPhone" data-value="${response}" />`);
                check_phone = true;
            },
            error: function (error) {
                alert('ì¸ì¦ë²ˆí˜¸ë¥¼ ìƒì„±í•˜ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            }
        });
    });

    $(document).on('click', '#BtnPhone', function () {
        if (!check_phone) {
            alert("ë¨¼ì € ì¸ì¦ë²ˆí˜¸ ë°œì†¡ì„ í´ë¦­í•´ì£¼ì„¸ìš”.");
            return;
        }

        let btnPhone = $('#uuid').val();
        let btnPhone1 = $(this).data("value");

        if (btnPhone === btnPhone1) {
            alert('ì—°ë½ì²˜ ì¸ì¦ ì„±ê³µ');
            $('#check5').hide();
            $('#User_Phone').attr('readonly', true);
        } else {
            alert('ì¸ì¦ë²ˆí˜¸ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”');
            $('#uuid').val("");
        }
    });
</script>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        // ëª¨ë“  íƒ­ ë²„íŠ¼ê³¼ íƒ­ ì½˜í…ì¸  ê°€ì ¸ì˜¤ê¸°
        const tabButtons = document.querySelectorAll(".tab-button");
        const tabContents = document.querySelectorAll(".tab-content");

        // ìˆ˜ì • ëª¨ë‹¬ ê´€ë ¨ ì½”ë“œ
        const modifyModal = document.getElementById("modifyModal");
        const modalOverlay = document.querySelector('.modal-overlay');
        const modalCancelButton = document.getElementById("modalCancelBtn");

        // 'ìˆ˜ì •' ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        document.getElementById("editProfileBtn").onclick = function(event) {
            event.preventDefault(); // í˜ì´ì§€ ìƒˆë¡œ ê³ ì¹¨ ë°©ì§€

            // ëª¨ë‹¬ì„ ì—´ê³ 
            modifyModal.style.display = "block";
            modalOverlay.style.display = 'block'; // ì˜¤ë²„ë ˆì´ë„ ì—´ê¸°
        };

        // ìˆ˜ì • ëª¨ë‹¬ x ë²„íŠ¼ í´ë¦­ ì‹œ ëª¨ë‹¬ ë‹«ê¸°
        document.getElementById("closeModifyModal").onclick = function() {
            modifyModal.style.display = "none";  // ëª¨ë‹¬ ë‹«ê¸°
            modalOverlay.style.display = 'none';  // ì˜¤ë²„ë ˆì´ ë‹«ê¸°
        };

        // ìˆ˜ì • ëª¨ë‹¬ ì·¨ì†Œ ë²„íŠ¼ í´ë¦­ ì‹œ
        modalCancelButton.onclick = function() {
            modifyModal.style.display = "none";  // ëª¨ë‹¬ ë‹«ê¸°
            modalOverlay.style.display = 'none'; // ì˜¤ë²„ë ˆì´ ë‹«ê¸°
        };

        // ê° íƒ­ ë²„íŠ¼ì— í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
        tabButtons.forEach((button) => {
            button.addEventListener("click", () => {
                // ëª¨ë“  ë²„íŠ¼ê³¼ ì½˜í…ì¸  ì´ˆê¸°í™”
                tabButtons.forEach((btn) => btn.classList.remove("active"));
                tabContents.forEach((content) => content.classList.remove("active"));

                // í´ë¦­í•œ ë²„íŠ¼ í™œì„±í™”
                button.classList.add("active");

                // í´ë¦­í•œ ë²„íŠ¼ì˜ data-tab ì†ì„±ì— í•´ë‹¹í•˜ëŠ” ì½˜í…ì¸  í™œì„±í™”
                const tabId = button.getAttribute("data-tab");
                document.getElementById(tabId).classList.add("active");
            });
        });
    });


    document.addEventListener('DOMContentLoaded', function () {
        // 1ï¸âƒ£ ì‹ ì²­í•œ ê²Œì‹œê¸€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        fetch('/myapplyList', { credentials: 'same-origin' })  // ì¿ í‚¤(ì„¸ì…˜) í¬í•¨
            .then(response => {
                if (!response.ok) {
                    throw new Error('ì‹ ì²­í•œ ê²Œì‹œê¸€ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return response.json();
            })
            .then(applies => {
                console.log(applies); // ë°›ì•„ì˜¨ ë°ì´í„° í™•ì¸
                const appliedPostList = document.querySelector('#apply-list');
                appliedPostList.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

                // ì‹ ì²­ ë‚´ì—­ì´ ì—†ì„ ê²½ìš° ë©”ì‹œì§€ ì¶œë ¥
                if (applies.length === 0) {
                    const noDataMessage = document.createElement('tr');
                    noDataMessage.innerHTML = '<td colspan="2">ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td>';
                    appliedPostList.appendChild(noDataMessage);
                    return;
                }

                // ì‹ ì²­ ë‚´ì—­ì´ ìˆì„ ê²½ìš° ê° í•­ëª©ì„ í‘œì— ì¶”ê°€
                applies.forEach(apply => {
                    const row = document.createElement('tr');

                    // ì œëª© (ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™)
                    const titleCell = document.createElement('td');
                    const link = document.createElement('a');
                    link.href = `/boarddetail/${apply.bnum}`;
                    link.textContent = apply.btitle;
                    titleCell.appendChild(link);
                    row.appendChild(titleCell);

                    // ì½”ìŠ¤ í™•ì¸ ë²„íŠ¼
                    const courseCell = document.createElement('td');
                    const courseButton = document.createElement('button');
                    courseButton.textContent = 'í”½ì—… ì½”ìŠ¤ í™•ì¸';
                    courseButton.onclick = () => {
                        window.location.href = `/course?bNum=${apply.bnum}`;
                    };
                    courseCell.appendChild(courseButton);
                    row.appendChild(courseCell);

                    appliedPostList.appendChild(row);
                });
            })
            .catch(error => {
                console.error('ì‹ ì²­í•œ ê²Œì‹œê¸€ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
            });

        // 2ï¸âƒ£ ì‘ì„±í•œ ì‹ ì²­ê¸€ ë¶ˆëŸ¬ì˜¤ê¸°
        fetch('/myboardList')
            .then(response => {
                if (!response.ok) {
                    throw new Error('ì‘ì„±í•œ ì‹ ì²­ê¸€ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                return response.json();
            })
            .then(boards => {
                const writtenPostList = document.querySelector('#written-post-list');
                writtenPostList.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

                // ì‘ì„±í•œ ì‹ ì²­ê¸€ì´ ì—†ì„ ê²½ìš° ë©”ì‹œì§€ ì¶œë ¥
                if (boards.length === 0) {
                    const noDataMessage = document.createElement('tr');
                    noDataMessage.innerHTML = '<td colspan="3">ì‘ì„±í•œ ì‹ ì²­ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</td>';
                    writtenPostList.appendChild(noDataMessage);
                    return;
                }

                boards.forEach(board => {
                    console.log("ë³´ë“œ ë°ì´í„°:", board);

                    const row = document.createElement('tr');

                    // ì œëª© (ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™)
                    const titleCell = document.createElement('td');
                    const link = document.createElement('a');
                    link.href = `/boarddetail/${board.bnum}`;
                    link.textContent = board.btitle;
                    titleCell.appendChild(link);
                    row.appendChild(titleCell);

                    // ì‘ì„±ì¼ (ë‚ ì§œ í¬ë§· ë³€í™˜)
                    const dateCell = document.createElement('td');
                    const bdate = new Date(board.reservationDate);
                    dateCell.textContent = bdate.toLocaleDateString('ko-KR', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    row.appendChild(dateCell);

                    // ë¦¬ë·° ì“°ê¸° ë²„íŠ¼
                    const reviewCell = document.createElement('td');
                    const reviewButton = document.createElement('button');
                    reviewButton.setAttribute('data-bnum', board.bnum);

                    if (board.rstatus === 1) {
                        reviewButton.textContent = 'ë¦¬ë·° ì™„ë£Œ';
                        reviewButton.disabled = true;
                    } else {
                        reviewButton.textContent = 'ë¦¬ë·° ì“°ê¸°';
                        reviewButton.onclick = function () {
                            openReviewModal(board.bnum, board.rstatus);
                        };
                    }

                    reviewCell.appendChild(reviewButton);
                    row.appendChild(reviewCell);

                    writtenPostList.appendChild(row);
                });
            })
            .catch(error => {
                console.error('ì‘ì„±í•œ ì‹ ì²­ê¸€ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
            });
    });

    // ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜
    function openReviewModal(bNum, rStatus) {
        if (rStatus === 1) {
            alert("ì´ë¯¸ ë¦¬ë·°ë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.");
            return;
        }

        const modal = document.getElementById('reviewModal');

        // BNumì„ ìˆ¨ê²¨ì§„ inputì— ì„¤ì •
        document.getElementById('BNum').value = bNum;

        // sessionì—ì„œ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ID ê°€ì ¸ì˜¤ê¸°
        fetch('/getSessionUserId')
            .then(response => response.json())
            .then(data => {
                const loginId = data.loginId;  // ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ID

                // UserIdë¥¼ ìˆ¨ê²¨ì§„ inputì— ì„¤ì •
                document.getElementById('UserId').value = loginId;

                modal.style.display = 'block';  // ëª¨ë‹¬ ì—´ê¸°
            })
            .catch(error => {
                console.error('ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì˜¤ë¥˜ ë°œìƒ:', error);
            });
    }


    // // ì‘ì„±í•œ ì‹ ì²­ê¸€ ë¶ˆëŸ¬ì˜¤ê¸°
    // fetch('/myboardList')
    //     .then(response => {
    //         if (!response.ok) {
    //             throw new Error('ì‹ ì²­ë‚´ì—­ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    //         }
    //         return response.json(); // response.json()ìœ¼ë¡œ ë³€ê²½: ì‘ë‹µ bodyë¥¼ JSONìœ¼ë¡œ íŒŒì‹±
    //     })
    //     .then(boards => {
    //         const writtenPostList = document.querySelector('#written-post-list');
    //         writtenPostList.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™” (ìƒˆë¡œìš´ ë°ì´í„° ë¡œë”© ì „ì—)
    //
    //         if (boards.length === 0) {
    //             const noDataMessage = document.createElement('tr');
    //             noDataMessage.classList.add('no-data-message');
    //             noDataMessage.innerHTML = '<td colspan="3">ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td>';
    //             writtenPostList.appendChild(noDataMessage);
    //             return;
    //         }
    //
    //         boards.forEach(board => {
    //             console.log("ë³´ë“œ ë°°ì—´í™•ì¸:", board) // ìˆ˜ì •: ì¢€ ë” ëª…í™•í•˜ê²Œ ë¡œê·¸ë¥¼ ì°ê¸° ìœ„í•´ ë³€ê²½
    //             // alert(board) // alertëŠ” ì‚¬ìš©ì ê²½í—˜ì„ í•´ì¹˜ë¯€ë¡œ ì œê±°í•˜ê±°ë‚˜ í•„ìš”ì‹œ ì£¼ì„ì²˜ë¦¬
    //             const row = document.createElement('tr');
    //
    //             const titleCell = document.createElement('td');
    //             const link = document.createElement('a');
    //             link.href = `/boarddetail/${board.bnum}`;
    //             link.textContent = board.btitle;
    //             titleCell.appendChild(link);
    //             row.appendChild(titleCell);
    //
    //             const dateCell = document.createElement('td');
    //             const bdate = new Date(board.bdate);
    //             const formattedDate = bdate.toLocaleDateString('ko-KR', { // ì¢€ ë” ëª…í™•í•œ ë‚ ì§œ í˜•ì‹ ì§€ì •
    //                 year: 'numeric',
    //                 month: 'long',
    //                 day: 'numeric'
    //             });
    //             dateCell.textContent = formattedDate;
    //             row.appendChild(dateCell);
    //
    //             // ë¦¬ë·°ì“°ê¸° ë²„íŠ¼
    //             const reviewCell = document.createElement('td');
    //             const reviewLink = document.createElement('button');
    //             reviewLink.setAttribute('data-bnum', board.bnum); // data-bnum ì†ì„± ì¶”ê°€
    //
    //             // rStatus ê°’ì— ë”°ë¼ ë²„íŠ¼ í…ìŠ¤íŠ¸ ë° ë™ì‘ ì„¤ì •
    //             if (board.rstatus === 1) {
    //                 reviewLink.textContent = 'ë¦¬ë·°ì™„ë£Œ';
    //                 reviewLink.disabled = true;
    //             } else {
    //                 reviewLink.textContent = 'ë¦¬ë·°ì“°ê¸°';
    //                 reviewLink.onclick = function () {
    //                     openReviewModal(board.bnum, board.rstatus); // rStatus ê°’ë„ í•¨ê»˜ ì „ë‹¬
    //                 };
    //             }
    //
    //             reviewCell.appendChild(reviewLink);
    //             row.appendChild(reviewCell);
    //
    //             writtenPostList.appendChild(row);
    //         });
    //
    //     })
    //     .catch(error => { // ì—ëŸ¬ í•¸ë“¤ë§ ì¶”ê°€: fetch ì‹¤íŒ¨ ì‹œ
    //         console.error('ì‹ ì²­ë‚´ì—­ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
    //         // alert('ì‹ ì²­ë‚´ì—­ì„ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.'); // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
    //     });

    // ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜
    function openReviewModal(bNum, rStatus) {
        if (rStatus === 1) {
            alert("ì´ë¯¸ ë¦¬ë·°ë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.");
            return;
        }

        const modal = document.getElementById('reviewModal');

        // BNumì„ ìˆ¨ê²¨ì§„ inputì— ì„¤ì •
        document.getElementById('BNum').value = bNum;

        // sessionì—ì„œ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ID ê°€ì ¸ì˜¤ê¸°
        fetch('/getSessionUserId')
            .then(response => response.json())
            .then(data => {
                const loginId = data.loginId;  // ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ID

                // UserIdë¥¼ ìˆ¨ê²¨ì§„ inputì— ì„¤ì •
                document.getElementById('UserId').value = loginId;

                modal.style.display = 'block';  // ëª¨ë‹¬ ì—´ê¸°
            })
            .catch(error => {
                console.error('ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì˜¤ë¥˜ ë°œìƒ:', error);
            });
    }

    // ëª¨ë‹¬ ë‹«ê¸°
    document.getElementById('closeModal').addEventListener('click', function () {
        const modal = document.getElementById('reviewModal');
        modal.style.display = 'none';  // ëª¨ë‹¬ ë‹«ê¸°
    });

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    window.addEventListener('click', function (event) {
        const modal = document.getElementById('reviewModal');
        if (event.target === modal) {
            modal.style.display = 'none';
        }
    });

    // ë³„ì  í´ë¦­ ì‹œ ì´ë²¤íŠ¸ ì²˜ë¦¬
    $(document).ready(function () {
        $('.stars i').on('click', function () {
            var value = $(this).data('value');
            $('#ratingValue').val(value);

            // ì„ íƒëœ ë³„ì ê¹Œì§€ í™©ê¸ˆìƒ‰ìœ¼ë¡œ ë³€ê²½
            $('.stars i').removeClass('active');
            for (var i = 0; i < value; i++) {
                $('.stars i').eq(i).addClass('active');
            }
        });
    });

    // íŒŒì¼ ì²¨ë¶€ í›„ ë¯¸ë¦¬ë³´ê¸°
    document.getElementById('revFile').addEventListener('change', function (event) {
        const file = event.target.files[0];
        const preview = document.getElementById('revImage');

        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                preview.src = e.target.result;
                preview.style.display = 'block';  // ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ë³´ì´ê¸°
            };
            reader.readAsDataURL(file);
        } else {
            preview.style.display = 'none';  // íŒŒì¼ì´ ì—†ìœ¼ë©´ ë¯¸ë¦¬ë³´ê¸° ìˆ¨ê¸°ê¸°
        }
    });

    // ë¦¬ë·° ì œì¶œ ì‹œ
    document.getElementById('reviewForm').addEventListener('submit', function (event) {
        event.preventDefault(); // ê¸°ë³¸ ì œì¶œ ë™ì‘ì„ ë§‰ìŒ

        const revContents = document.getElementById('revContents').value;
        const ratingValue = document.getElementById('ratingValue').value;
        const bNum = document.getElementById('BNum').value; // BNumì„ ìˆ¨ê²¨ì§„ inputì—ì„œ ê°€ì ¸ì˜´
        const userId = document.getElementById('UserId').value; // UserIdë¥¼ ìˆ¨ê²¨ì§„ inputì—ì„œ ê°€ì ¸ì˜´

        console.log(ratingValue);

        if (ratingValue === "0") {
            alert("ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
            return;
        }

        const fileInput = document.getElementById('revFile');
        const formData = new FormData();

        if (fileInput.files.length > 0) {
            formData.append('revFile', fileInput.files[0]);
        }

        // formDataì˜ ë‚´ìš©ì„ ì½˜ì†”ì— ì¶œë ¥ (íŒŒì¼ ì¶”ê°€ í™•ì¸ìš©)
        for (let [key, value] of formData.entries()) {
            console.log(key, value);
        }

        // ë¦¬ë·° ë‚´ìš©ê³¼ ë³„ì  ì¶”ê°€
        formData.append('bNum', bNum);
        formData.append('revContents', revContents);
        formData.append('Rating', ratingValue); // ì—¬ê¸°ë¥¼ 'Rating'ìœ¼ë¡œ ìˆ˜ì •
        formData.append('userId', userId);  // UserId ì¶”ê°€

        fetch('http://localhost:9091/RWrite', {
            method: 'POST',
            body: new FormData(document.getElementById('reviewForm'))  // í¼ ë°ì´í„° ì „ì†¡
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${response.status}`);
                }
                return response.json();  // JSON ì‘ë‹µ ë³€í™˜
            })
            .then(data => {
                console.log('ì„œë²„ ì‘ë‹µ:', data);  // ì„œë²„ ì‘ë‹µ ì½˜ì†” ì¶œë ¥

                if (data.success) {
                    alert('ë¦¬ë·°ê°€ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!');

                    // "ë¦¬ë·°ì“°ê¸°" ë²„íŠ¼ì„ "ì‘ì„±ì™„ë£Œ" ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½í•˜ê³  ë¹„í™œì„±í™”
                    const bNum = document.getElementById('BNum').value;  // BNum ê°€ì ¸ì˜¤ê¸°
                    const reviewButton = document.querySelector(`button[data-bnum='${bNum}']`);
                    if (reviewButton) {
                        reviewButton.textContent = 'ë¦¬ë·°ì™„ë£Œ';
                        reviewButton.disabled = true;
                    }

                    // ëª¨ë‹¬ ë‹«ê¸°
                    closeModal();
                } else {
                    alert('ë¦¬ë·° ì œì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            })
            .catch(error => {
                console.error('ë¦¬ë·° ì œì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('ì„œë²„ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });

        // âœ… ëª¨ë‹¬ì„ ë‹«ëŠ” í•¨ìˆ˜
        function closeModal() {
            const modal = document.getElementById('reviewModal');
            if (modal) {
                modal.style.display = 'none';
                document.getElementById('reviewForm').reset(); // í¼ ì´ˆê¸°í™”
            }
        }

    });

    // document.addEventListener('DOMContentLoaded', function () {
    //     fetch('/myapplyList', { credentials: 'same-origin' })  // ì¿ í‚¤(ì„¸ì…˜) í¬í•¨
    //         .then(response => {
    //             if (!response.ok) {
    //                 throw new Error('ì‹ ì²­í•œ ê²Œì‹œê¸€ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
    //             }
    //             return response.json();
    //         })
    //         .then(applies => {
    //             console.log(applies); // ë°›ì•„ì˜¨ ë°ì´í„° í™•ì¸
    //             const appliedPostList = document.querySelector('#apply-list');
    //             if (appliedPostList) {
    //                 // ë§Œì•½ ì‹ ì²­ ë‚´ì—­ì´ ì—†ìœ¼ë©´ "ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤." ë©”ì‹œì§€ ì¶œë ¥
    //                 if (applies.length === 0) {
    //                     const noDataMessage = document.createElement('div');
    //                     noDataMessage.classList.add('no-data-message');
    //                     noDataMessage.textContent = 'ì‹ ì²­ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.';
    //                     appliedPostList.appendChild(noDataMessage);
    //                     return;
    //                 }
    //
    //                 // ì‹ ì²­ ë‚´ì—­ì´ ìˆì„ ê²½ìš° ê° í•­ëª© ì¶”ê°€
    //                 applies.forEach(apply => {
    //                     const contentItem = document.createElement('div');
    //                     contentItem.classList.add('content-item');
    //
    //                     const link = document.createElement('a');
    //                     link.href = `/boarddetail/${apply.bnum}`;
    //                     link.textContent = ` ${apply.btitle}`;
    //                     contentItem.appendChild(link);
    //
    //                     const courseButton = document.createElement('button');
    //                     courseButton.textContent = 'í”½ì—… ì½”ìŠ¤ í™•ì¸';
    //                     courseButton.onclick = () => {
    //                         window.location.href = `/course?bNum=${apply.bnum}`;
    //                     };
    //                     contentItem.appendChild(courseButton);
    //
    //                     appliedPostList.appendChild(contentItem);
    //                 });
    //             } else {
    //                 console.error('Element #apply-list not found.');
    //             }
    //         })
    //         .catch(error => {
    //             console.error('Error:', error);
    //         });
    // });


    // ë‚´ê°€ ì“´ ë¦¬ë·° ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    fetch('/myReviewList')
        .then(response => {
            if (!response.ok) {
                if (response.status === 401) {
                    throw new Error('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                }
                if (response.status === 204) {
                    return Promise.resolve([]);
                }
                throw new Error('ë¦¬ë·° ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
            return response.json();
        })
        .then(reviews => {
            const myReviewList = document.querySelector('#myreview-list');
            myReviewList.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

            if (reviews && reviews.length > 0) {
                reviews.forEach(review => {
                    const row = document.createElement('tr');

                    // ê²Œì‹œê¸€ ì œëª© (ì¶”ê°€)
                    const boardTitleCell = document.createElement('td');
                    boardTitleCell.textContent = review.btitle;
                    row.appendChild(boardTitleCell);

                    // ë¦¬ë·° ë‚´ìš©
                    const reviewContentCell = document.createElement('td'); // ë³€ìˆ˜ëª… ë³€ê²½ (titleCell -> reviewContentCell)
                    reviewContentCell.textContent = review.revContents;  // í…ìŠ¤íŠ¸ë§Œ ì¶”ê°€
                    row.appendChild(reviewContentCell);

                    // ë³„ì 
                    const ratingCell = document.createElement('td');
                    const ratingSpan = document.createElement('span');
                    ratingSpan.classList.add('rating-stars');
                    for (let i = 1; i <= 5; i++) {
                        const star = document.createElement('i');
                        star.classList.add('fa');
                        if (i <= review.rating) {
                            star.classList.add('fa-star');  // ì±„ì›Œì§„ ë³„
                        } else {
                            star.classList.add('fa-star-o');  // ë¹ˆ ë³„
                        }
                        ratingSpan.appendChild(star);
                    }
                    ratingCell.appendChild(ratingSpan);
                    row.appendChild(ratingCell);

                    // ê²Œì‹œê¸€ ë³´ê¸°
                    const detailCell = document.createElement('td');
                    const detailLink = document.createElement('a');
                    detailLink.href = `/boarddetail/${review.bnum}`;
                    detailLink.textContent = 'ìƒì„¸ë³´ê¸°';
                    detailCell.appendChild(detailLink);
                    row.appendChild(detailCell);

                    myReviewList.appendChild(row);
                });
            } else {
                // ë¦¬ë·°ê°€ ì—†ìœ¼ë©´ 'ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤' ë©”ì‹œì§€ë¥¼ ì¶”ê°€
                const noDataMessage = document.createElement('tr');
                noDataMessage.classList.add('no-data-message');
                noDataMessage.innerHTML = '<td colspan="4">ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</td>'; // colspan ìˆ˜ì • (3 -> 4)
                myReviewList.appendChild(noDataMessage);
            }
        })
        .catch(error => {
            // ì—ëŸ¬ ë°œìƒ ì‹œ í…Œì´ë¸”ì— ì—ëŸ¬ ë©”ì‹œì§€ ì¶”ê°€
            const myReviewList = document.querySelector('#myreview-list');
            myReviewList.innerHTML = '<tr><td colspan="4">ì‘ì„±í•œ ë¦¬ë·°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>'; // colspan ìˆ˜ì • (3 -> 4)
        });

    // ëŒë´„ì¼ì§€ ë¶ˆëŸ¬ì˜¤ê¸°
    $(document).ready(function () {
        var userId = $('#userIdcheck').val();
        console.log("ë¡œê·¸ì¸ëœ userId:", userId);

        $.ajax({
            url: '/diaryList',
            type: 'GET',
            data: { userId: userId },
            success: function (response) {
                console.log("ì„œë²„ ì‘ë‹µ:", response);
                response = Array.isArray(response) ? response : [];

                var diaryList = $('#diary-list');
                diaryList.empty();
                var tableBody = $('.care-list');
                tableBody.empty();

                if (response.length === 0) {
                    diaryList.append('<p>ë“±ë¡ëœ ëŒë´„ ì¼ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>');
                    return;
                }

                response.forEach(function (diary) {
                    // console.log("ì¼ì§€ ë°ì´í„°:", diary.reservationDate, diary.petName);
                    var formattedDate = new Date(diary.reservationDate).toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' });
                    var diaryEntry = `<a href="#" class="diary-link" data-reservation-date="${diary.reservationDate}" data-pet-name="${diary.petName}">ğŸ¶ ${formattedDate}, ${diary.petName}ì˜ ëŒë´„ì¼ê¸° ğŸ’Œ</a><br>`;
                    diaryList.append(diaryEntry);
                });

                // ëª¨ë‹¬ ì˜¤í”ˆ ì´ë²¤íŠ¸
                $('.diary-link').click(function (event) {
                    event.preventDefault();
                    var reservationDate = $(this).data('reservation-date');
                    var petName = $(this).data('pet-name');

                    // reservationDateë¥¼ ë…„, ì›”, ì¼ í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ…
                    var formattedDate = new Date(reservationDate).toLocaleDateString('ko-KR', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    }).replace(/ /g, ' ').replace(/ì¼$/,'ì¼,');  // ê³µë°±ì„ ì œê±°í•˜ì—¬ ì›í•˜ëŠ” í˜•ì‹ìœ¼ë¡œ ë§Œë“­ë‹ˆë‹¤.

                    // ëª¨ë‹¬ ì œëª© ì„¤ì • (í¬ë§·ëœ ë‚ ì§œ ì‚¬ìš©)
                    $('#modal-title').text(`${formattedDate} ${petName}ì˜ ëŒë´„ì¼ê¸°`);
                    $('#careDiaryModal').show();
                    $('#modalOverlay').show();


                    // í•´ë‹¹ ë°˜ë ¤ê²¬ì˜ ëŒë´„ ì¼ì§€ ë¡œë“œ
                    var selectedDiary = response.find(diary => String(diary.reservationDate) === String(reservationDate) && String(diary.petName) === String(petName));
                    console.log('ì‘ë‹µ ë°ì´í„°: ', response)
                    if (!selectedDiary) {
                        console.error("í•´ë‹¹ ì¼ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ");
                        return;
                    }

                    tableBody.empty();
                    var row = `
                    <tr>
    <td colspan="2">
        <img src="/upload/${selectedDiary.petPlayProfileName || '/default-image.png'}" alt="ë°˜ë ¤ë™ë¬¼ ì‚¬ì§„" style="width:90%; height:300px; object-fit:cover;">
    </td>
</tr>
                       <tr>
    <td><img src="/images/meal.png" alt="ë°¥ ì•„ì´ì½˜" style="width:24px; height:24px;"></td>
    <td>${selectedDiary.meal || ''}</td>
</tr>
<tr>
    <td><img src="/images/snack.png" alt="ê°„ì‹ ì•„ì´ì½˜" style="width:24px; height:24px;"></td>
    <td>${selectedDiary.snack || ''}</td>
</tr>
<tr>
    <td><img src="/images/play.png" alt="ë†€ì´ ì•„ì´ì½˜" style="width:24px; height:24px;"></td>
    <td>${selectedDiary.play || ''}</td>
</tr>
<tr>
    <td><img src="/images/poop.png" alt="ë°°ë³€ ì•„ì´ì½˜" style="width:24px; height:24px;"></td>
    <td>${selectedDiary.toilet || ''}</td>
</tr>
<tr>
    <td><img src="/images/sleep.png" alt="ìˆ˜ë©´ ì•„ì´ì½˜" style="width:24px; height:24px;"></td>
    <td>${selectedDiary.sleep || ''}</td>
</tr>
<tr>
    <td><img src="/images/bath.png" alt="ëª©ìš• ì•„ì´ì½˜" style="width:24px; height:24px;"></td>
    <td>${selectedDiary.bath || ''}</td>
</tr>
<tr>
    <td><img src="/images/hospital.png" alt="ë³‘ì› ì•„ì´ì½˜" style="width:24px; height:24px;"></td>
    <td>${selectedDiary.hospital || ''}</td>
</tr>
<tr>
    <td><img src="/images/walk.png" alt="ì‚°ì±… ì•„ì´ì½˜" style="width:24px; height:24px;"></td>
    <td>${selectedDiary.walk || ''}</td>
</tr>`

                    tableBody.append(row);
                });
            },
            error: function (xhr, status, error) {
                console.error("AJAX ì—ëŸ¬:", xhr, status, error);
            }
        });
    });
</script>
<script>
    // ë“±ë¡ëœ ë°˜ë ¤ê²¬ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
    $(document).ready(function () {
        // "ë‚´ ë°˜ë ¤ê²¬ ì •ë³´" íƒ­ í´ë¦­ ì‹œ
        $('#petTab').on('click', function () {
            // AJAX ìš”ì²­í•˜ì—¬ ì„œë²„ì—ì„œ ë°˜ë ¤ê²¬ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            $.ajax({
                url: '/getPetInfo',  // ë°˜ë ¤ê²¬ ì •ë³´ ìš”ì²­
                method: 'GET',
                success: function (response) {
                    console.log("ì‘ë‹µ ë°ì´í„°:", response);  // ì‘ë‹µ ë°ì´í„° í™•ì¸

                    // ë°˜ë ¤ê²¬ ì •ë³´ê°€ ìˆìœ¼ë©´ ì¶œë ¥
                    if (response && response.length > 0) {
                        let petInfoHtml = '';
                        response.forEach(pet => {
                            petInfoHtml += `
                        <div class="pet-card">
                            <div class="header">í‚µí« ì¹œêµ¬ ë“±ë¡ì¦</div>
                            <div class="content">
                                <div class="photo">
                                    <img src="${pet.petProfileName ? pet.petProfileName : '/images/default.png'}" alt="${pet.petName || 'ì´ë¦„ ì—†ìŒ'} í”„ë¡œí•„">
                                </div>
                                <div class="info">
                                    <p><strong>ì´ë¦„:</strong> ${pet.petName || 'ì´ë¦„ ì—†ìŒ'}</p>
                                    <p><strong>ë‚˜ì´:</strong> ${pet.petAge !== null ? pet.petAge : 'ì•Œ ìˆ˜ ì—†ìŒ'}</p>
                                    <p><strong>í¬ê¸°:</strong> ${getSizeText(pet.categoryNum)}</p>
                                    <p><strong>ì„±ë³„:</strong> ${getGenderText(pet.petGender)}</p>
                                    <p><strong>ì¤‘ì„±í™” ì—¬ë¶€:</strong> ${getNeuteringText(pet.petNeutering)}</p>
                                    <p><strong>ì ‘ì¢… ì—¬ë¶€:</strong> ${getVaccinText(pet.petVaccin)}</p>
                                </div>
                            </div>
                        </div>
                        `;
                        });

                        // ê·¸ë¦¬ë“œ ì»¨í…Œì´ë„ˆë¡œ .pet-cards-container ê°ì‹¸ê¸°
                        $('#petInfo').html(`
                    <div class="pet-cards-container">
                        ${petInfoHtml}
                    </div>
                    `);
                    } else {
                        $('#petInfo').html('<p>ë“±ë¡ëœ ë°˜ë ¤ë™ë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>');
                    }
                },
                error: function (xhr, status, error) {
                    console.log("ì—ëŸ¬ ë°œìƒ:", error);
                    $('#petInfo').html('<p>ë°˜ë ¤ë™ë¬¼ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>');
                }
            });
        });


        // í¬ê¸° ë³€í™˜ í•¨ìˆ˜
        function getSizeText(size) {
            const sizeMap = {
                1: "í¼í”¼",
                2: "ì†Œí˜•ê²¬",
                3: "ì¤‘í˜•ê²¬",
                4: "ëŒ€í˜•ê²¬",
                5: "í‚¤íŠ¼",
                6: "ì†Œí˜•ë¬˜",
                7: "ì¤‘í˜•ë¬˜",
                8: "ëŒ€í˜•ë¬˜",
            };
            return sizeMap[size] || "ì•Œ ìˆ˜ ì—†ìŒ";
        }

        // ì„±ë³„ ë³€í™˜ í•¨ìˆ˜
        function getGenderText(gender) {
            const genderMap = {
                1: "ë‚¨ì",
                2: "ì—¬ì"
            };
            return genderMap[gender] || "ì•Œ ìˆ˜ ì—†ìŒ";
        }

        // ì¤‘ì„±í™” ì—¬ë¶€ ë³€í™˜ í•¨ìˆ˜
        function getNeuteringText(neutering) {
            const neuteringMap = {
                1: "ìœ ",
                2: "ë¬´"
            };
            return neuteringMap[neutering] || "ì•Œ ìˆ˜ ì—†ìŒ";
        }

        // ì ‘ì¢… ì—¬ë¶€ ë³€í™˜ í•¨ìˆ˜
        function getVaccinText(vaccin) {
            const vaccinMap = {
                1: "ìœ ",
                2: "ë¬´"
            };
            return vaccinMap[vaccin] || "ì•Œ ìˆ˜ ì—†ìŒ";
        }
    });
    // Get modal and close button
    const modal = document.getElementById('careDiaryModal');
    const closeBtn = document.getElementById('closeDiaryyModal');
    const overlay = document.getElementById('modalOverlay');

    // Close modal when the user clicks outside of the modal content
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
            overlay.style.display = "none"; // Close overlay
        }
    }

    // Close modal when the close button is clicked
    closeBtn.onclick = function() {
        modal.style.display = "none";
        overlay.style.display = "none"; // Close overlay
    }



    // ë¦¬ë·° ì œì¶œ ì‹œ
    document.getElementById('reviewForm').addEventListener('submit', function (event) {
        event.preventDefault(); // ê¸°ë³¸ ì œì¶œ ë™ì‘ì„ ë§‰ìŒ

        const revContents = document.getElementById('revContents').value;
        const ratingValue = document.getElementById('ratingValue').value;
        const bNum = document.getElementById('BNum').value; // BNumì„ ìˆ¨ê²¨ì§„ inputì—ì„œ ê°€ì ¸ì˜´
        const userId = document.getElementById('UserId').value; // UserIdë¥¼ ìˆ¨ê²¨ì§„ inputì—ì„œ ê°€ì ¸ì˜´

        console.log(ratingValue);

        if (ratingValue === "0") {
            alert("ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
            return;
        }

        const fileInput = document.getElementById('revFile');
        const formData = new FormData();

        if (fileInput.files.length > 0) {
            formData.append('revFile', fileInput.files[0]);
        }

        // formDataì˜ ë‚´ìš©ì„ ì½˜ì†”ì— ì¶œë ¥ (íŒŒì¼ ì¶”ê°€ í™•ì¸ìš©)
        for (let [key, value] of formData.entries()) {
            console.log(key, value);
        }

        // ë¦¬ë·° ë‚´ìš©ê³¼ ë³„ì  ì¶”ê°€
        formData.append('bNum', bNum);
        formData.append('revContents', revContents);
        formData.append('Rating', ratingValue); // ì—¬ê¸°ë¥¼ 'Rating'ìœ¼ë¡œ ìˆ˜ì •
        formData.append('userId', userId);  // UserId ì¶”ê°€

        // ì„œë²„ì— ë¦¬ë·° ì œì¶œ
        fetch('/RWrite', {
            method: 'POST',
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('ë¦¬ë·°ê°€ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!');

                    // "ë¦¬ë·°ì“°ê¸°" ë²„íŠ¼ì„ "ì‘ì„±ì™„ë£Œ" ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½í•˜ê³  ë¹„í™œì„±í™”
                    const reviewButton = document.querySelector(`button[data-bnum='${bNum}']`);
                    if (reviewButton) {
                        reviewButton.textContent = 'ë¦¬ë·°ì™„ë£Œ';
                        reviewButton.disabled = true;
                    }

                    // ëª¨ë‹¬ ë‹«ê¸°
                    const modal = document.getElementById('reviewModal');
                    modal.style.display = 'none';
                } else {
                    alert('ë¦¬ë·° ì œì¶œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            })
            .catch(error => {
                console.error('ì„œë²„ í†µì‹  ì˜¤ë¥˜:', error);
                alert('ì„œë²„ì— ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
    });

</script>
</body>
</html>