<!doctype html>
<html lang="ko">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
<!--    <meta content="Untree.co" name="author">-->
<!--    <link href="/static/favicon.png" rel="shortcut icon">-->

<!--    <meta content="" name="description"/>-->
<!--    <meta content="bootstrap, bootstrap4" name="keywords"/>-->

<!--    <link href="https://fonts.googleapis.com" rel="preconnect">-->
<!--    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">-->
<!--    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Source+Serif+Pro:wght@400;700&display=swap"-->
<!--          rel="stylesheet">-->
<!--    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">-->
    <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">
    <link href="/css/header.css" rel="stylesheet">
    <link href="/css/board.css" rel="stylesheet">
    <link rel="shortcut icon" href="/images/favicon.ico">
<!--    <link href="/css/bootstrap.min.css" rel="stylesheet">-->
<!--    <link href="/css/owl.carousel.min.css" rel="stylesheet">-->
<!--    <link href="/css/owl.theme.default.min.css" rel="stylesheet">-->
<!--    <link href="/css/jquery.fancybox.min.css" rel="stylesheet">-->
<!--    <link href="/fonts/icomoon/style.css" rel="stylesheet">-->
<!--    <link href="/fonts/flaticon/font/flaticon.css" rel="stylesheet">-->
<!--    <link href="/css/daterangepicker.css" rel="stylesheet">-->
<!--    <link href="https://unpkg.com/aos@next/dist/aos.css" rel="stylesheet"/>-->
<!--    <link href="/css/header.css" rel="stylesheet">-->
<!--    <link href="/css/board.css" rel="stylesheet">-->
<!--    <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet">-->

    <title>KeePet - Premium Pet Sitter</title>
</head>

<body>
<!-- ##### Header Area Start ##### -->
<header id="header">
    <div th:replace="~{header.html}"></div>
</header>

</br></br>
</br></br>

<div class="row" id="row">
    <div class="col-12">
<!--        <div class="search-wrapper">-->
<!--            <select id="category">-->
<!--                <option value="UserNickname">닉네임</option>-->
<!--                <option value="RevTitle">제목</option>-->
<!--                <option value="RevContent">내용</option>-->
<!--            </select>-->
<!--            <div class="ui-input-container" id="ui-input">-->
<!--                <input class="ui-input" id="keyword" placeholder="Type something..." required="" type="text"/>-->
<!--                <div class="ui-input-underline"></div>-->
<!--                <div class="ui-input-highlight"></div>-->
<!--                <div class="ui-input-icon">-->
<!--                    <button id="searchBtn" type="submit">-->
<!--                        <svg fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">-->
<!--                            <path-->
<!--                                    d="M21 21L16.65 16.65M19 11C19 15.4183 15.4183 19 11 19C6.58172 19 3 15.4183 3 11C3 6.58172 6.58172 3 11 3C15.4183 3 19 6.58172 19 11Z"-->
<!--                                    stroke="currentColor"-->
<!--                                    stroke-linecap="round"-->
<!--                                    stroke-linejoin="round"-->
<!--                                    stroke-width="2"></path>-->
<!--                        </svg>-->
<!--                    </button>-->
<!--                </div>-->
<!--            </div>-->
<!--            <input class="btn-board-form" id="board-form" type="button" value="글쓰기"/>-->
<!--        </div>-->
    </div>
    <form class="board1">
        <br/>

        <div class="divider">
            🐕🐩🐕‍🦺🦮🐕🐩🐕‍🦺🦮🐕🐩🐕‍🦺🦮🐕🐩🐕‍🦺🦮🐕🐩🐕‍🦺🦮🐕🐩🐕‍🦺🦮🐕🐩🐕‍🦺🦮🐕🐩🐕‍🦺🦮<input class="btn-board-form" id="board-form" type="button" value="글쓰기"/>
        </div>
        <br>

        <!-- 태우고 목록 보기 -->
        <div class="boardmenu">
            <div class="board-item1 d-flex flex-wrap" id="board-album">
                <!-- 게시글 로드 -->
            </div>

        </div>

        <div class="board1-bod1-a">
            <!-- 페이징 버튼 -->
            <div class="pagination" id="paging">
            </div>

        </div>
    </form>


    <!-- 예약 작성 모달 폼 -->
    <div class="modal-overlay" id="bWriteModal" style="display: none; ">
        <div class="modal-content">
            <span class="close" id="closeBWriteModal">×</span>
            <h2 class="modal-title" id="bWriteModalLabel">예약 작성</h2>
            <div class="modal-body">

                <div class="row">
                    <div class="form-content">
                        <form action="/bWrite" class="form" enctype="multipart/form-data" method="post" name="bWriteForm">
                            <input name="UserId" th:value="${session.loginId}" type="hidden"/>
                            <input name="PetStatus" value="0" type="hidden">

                            <div id="contents">
                                <label for="BTitle">제목</label>
                                <input class="form-control custom-input" id="BTitle" name="BTitle" readonly
                                       style="border: none"
                                       th:value="'신청합니다.'" type="text"/>

                                <label for="Guardian_Name">보호자 이름</label>
                                <input id="Guardian_Name" name="GuardianName" th:value="${session.loginId}" type="text">

                                <label for="Guardian_Phone">보호자 연락망</label>
                                <input id="Guardian_Phone" maxlength="11" name="GuardianPhone" pattern="[0-9]{11}"
                                       placeholder="'-'없이 숫자만 입력해주세요." th:value="${session.loginPhone}" type="text">

                                <label for="Guardian_Address">보호자 주소</label>
                                <input id="postCode" onclick="sample6_execDaumPostcode()" type="button" value="우편번호 찾기"><br>
                                <input id="bSample6_address" placeholder="주소" th:value="${session.loginAddress}"
                                       type="text"><br>
                                <input id="Guardian_Address" name="GuardianAddress" type="hidden">

                                <label for="petNum">반려견 선택</label>
                                <select class="form-control custom-select" id="petNum" name="PetNum">
                                    <option value="">-- 선택 --</option>
                                    <!-- pets 목록이 여기에 동적으로 삽입됩니다. -->
                                </select>

                                <br/>

                                <label for="bService">원하는 서비스</label>
                                <!-- 서비스 선택 버튼들 -->
                                <div class="options">
                                    <button class="option" data-service="1" onclick="selectOption(event, 1)" type="button">
                                        산책
                                    </button>
                                    <button class="option" data-service="2" onclick="selectOption(event, 2)" type="button">
                                        목욕
                                    </button>
                                    <button class="option" data-service="3" onclick="selectOption(event, 3)" type="button">
                                        미용
                                    </button>
                                    <button class="option" data-service="4" onclick="selectOption(event, 4)" type="button">
                                        병원
                                    </button>
                                    <button class="option" data-service="5" onclick="selectOption(event, 5)" type="button">
                                        공항픽업
                                    </button>
                                </div>
                                <div class="selected" id="selectedOption"></div>
                                <div class="another-selected" id="anotherSelectedOption"></div>
                                <input id="bService" name="BServices" required type="hidden"/>

                                <label for="Reservation_Date">예약 날짜</label>
                                <input id="Reservation_Date" name="ReservationDate" placeholder="예약 날짜를 선택해주세요."
                                       type="text">

                                <label for="bTime">예약 시간</label>
                                <div class="options1">
                                    <button class="option1" data-option="1" type="button">풀타임(오전 8시 ~ 오후 7시)</button>
                                    <button class="option1" data-option="2" type="button">파트타임(상세내용에 표기)</button>
                                    <button class="option1" data-option="3" type="button">하프타임A(오전 8시 ~ 오후 2시)</button>
                                    <button class="option1" data-option="4" type="button">하프타임B(오후 2시 ~ 오후 7시)</button>
                                </div>
                                <div class="selected" id="selectedOption22"></div>
                                <input id="bTime" name="BTime" required type="hidden"/>

                                <label for="B_Contents">상세 내용</label>
                                <textarea id="B_Contents" name="BContents" placeholder="파트타임(원하시는 시간대), 요청사항 등을 입력해주세요."
                                          type="text"></textarea>

                                <label for="B_File">첨부파일</label>
                                <input id="B_File" name="BFile" type="file"/>
                                <br/><img id="preImage" width="150px"/>

                                <div id="button">
                                    <input id="bSubmitForm" type="submit" value="예약"/>
                                    <input id="cancel" type="button" value="취소"/>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- 비밀번호 입력 모달 -->
<div id="passwordModal" style="display:none;
    position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
    padding: 20px; border-radius: 8px; background-color: #f9f9f9;
    width: 300px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); z-index: 9999;">

    <!-- 닫기 버튼 -->
    <span id="closePasswordModal" style="position: absolute; top: 10px; right: 10px;
        font-size: 20px; cursor: pointer; color: #777;">x</span>

    <h3 style="text-align: center; font-family: Arial, sans-serif; font-size: 18px; color: #333;">비밀번호 확인</h3>

    <label for="password" style="font-size: 14px; color: #555;">현재 비밀번호:</label>
    <input type="password" id="password" placeholder="비밀번호를 입력하세요"
           style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc;
        border-radius: 4px; font-size: 14px;">

    <button id="submitPassword" style="width: 100%; padding: 10px; background-color: #4CAF50;
        color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer;">
        확인
    </button>

    <p id="errorMessage" style="color: red; display: none; font-size: 14px;
        text-align: center; margin-top: 10px;">
        비밀번호가 틀렸습니다.
    </p>
</div>





<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/jquery-3.4.1.min.js"></script>
<script src="/js/custom.js"></script>
<script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ko.js"></script>
<script>
    AOS.init();
</script>
</body>

<script>

    // 닫기 버튼 클릭 시 모달 숨기기
    document.getElementById("closePasswordModal").addEventListener("click", function() {
        document.getElementById("passwordModal").style.display = "none";
    });


    document.addEventListener('DOMContentLoaded', function () {
        const modalOverlay = document.querySelector('.modal-overlay');
        const bWriteModal = document.getElementById('bWriteModal');
        const showBWriteModalBtn = document.getElementById('board-form');
        const closeBWriteModal = document.getElementById('closeBWriteModal');

    // '예약 작성' 버튼 클릭 시 모달 열기
    showBWriteModalBtn.addEventListener('click', function () {
        // URL에 showModal=true 파라미터를 추가하여 모달 표시
        window.location.href = window.location.pathname + '?showModal=true';
    });

    // 모달 닫기
    closeBWriteModal.addEventListener('click', function () {
        bWriteModal.style.display = 'none';
        modalOverlay.style.display = 'none';
    });

    // 모달 외부(오버레이) 클릭 시 닫기
    document.querySelector('.modal-overlay').addEventListener("click", function (event) {
        if (event.target === document.querySelector('.modal-overlay')) {
            document.getElementById("bWriteModal").style.display = "none";
            document.querySelector('.modal-overlay').style.display = "none";
        }
    });

    // URL 파라미터로 showModal이 true이면 모달을 열기
    const urlParams = new URLSearchParams(window.location.search);
    const showModal = urlParams.get('showModal');

    if (showModal === 'true') {
        bWriteModal.style.display = 'block';  // 모달 열기
        modalOverlay.style.display = 'block';  // 배경 오버레이 열기
        fetchPets();  // 서버에서 pets 목록을 가져와서 모달에 삽입
    }

    // 서버에서 pets 목록을 받아오는 함수
    function fetchPets() {
        fetch("/bWriteForm")
            .then(response => response.json())
            .then(data => {
                const petSelect = document.getElementById('petNum');
                const pets = data.pets;

                // 기존의 옵션들 초기화
                petSelect.innerHTML = '<option value="">-- 선택 --</option>';

                // pets 목록을 option 태그로 추가
                pets.forEach(pet => {
                    const option = document.createElement('option');
                    option.value = pet.petNum;
                    option.textContent = pet.petName;
                    petSelect.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Error fetching pets:', error);
            });
    }
    });


    // $(document).ready(function () {
    //     // 글쓰기 버튼 클릭 시 "/Board/boardform"으로 이동
    //     $('#board-form').click(function () {
    //         window.location.href = '/bWriteForm';
    //     });

    let list = [];
    let page = 1;        // 현재 페이지 번호
    let limit = 10;       // 한 페이지에 출력될 데이터 개수
    const block = 5;     // 한 블록에 출력될 페이지 개수
    let count = 0;       // 전체 데이터 개수

    // 초기 데이터 로드
    loadBoardList();

    function loadBoardList() {
        $.ajax({
            type: "post",
            url: "/boardList",
            data: { petStatus: 0 }, // 🟢 반려묘(고양이) 데이터만 요청
            success: (result) => {
                list = result;
                count = list.length;  // 전체 데이터 개수 업데이트
                pagingList(page);
            },
            error: () => {
                alert('boardList 불러오기 실패!!');
            }
        });
    }

    function pagingList(page) {
        const maxPage = Math.ceil(count / limit);
        const startRow = (page - 1) * limit;
        const endRow = Math.min(page * limit - 1, count - 1);

        const startPage = Math.floor((page - 1) / block) * block + 1;
        const endPage = Math.min(startPage + block - 1, maxPage);

        // 게시글 출력 (이미지 아래 제목과 작성자 정보 표시)
        let output = '';
        if (count > 0) {
            for (let i = startRow; i <= endRow; i++) {
                const board = list[i];
                const imageUrl = board[2] ? `/boardupload/${board[2]}` : '/images/default.png'; // 기본 이미지 설정
                output += `
            <div class="board-card">
                <div class="thumbnail">
                    <a href="#" class="viewPost" data-board-id="${board[0]}" style="text-decoration: none; color: black;">
                        <img src="${imageUrl}" alt="Thumbnail" onerror="this.src='/images/default.png'" />
                    </a>
                </div>
                <div class="content">
                    <a href="#" class="viewPost" data-board-id="${board[0]}" class="title" style="text-decoration: none; color: black;">${board[1]}🔒</a> <!-- 게시글 제목 -->
                    <p class="author">${board[3]}</p> <!-- 작성자 정보 -->
                </div>
            </div>
            `;
            }
        } else {
            output = '<p>게시글이 없습니다.</p>';
        }
        $('#board-album').html(output);

        // 페이징 출력
        let pageNum = '';
        pageNum += page <= 1
            ? `<span class="prev">이전</span>`
            : `<a href="#" class="prev" data-page="${page - 1}">이전</a>`;

        for (let i = startPage; i <= endPage; i++) {
            pageNum += page === i
                ? `<span class="iNum">${i}</span>`
                : `<a href="#" class="iNum" data-page="${i}">${i}</a>`;
        }

        pageNum += page >= maxPage
            ? `<span class="next">다음</span>`
            : `<a href="#" class="next" data-page="${page + 1}">다음</a>`;

        $('#paging').html(pageNum);
    }

    // 게시글 상세보기 버튼 클릭 이벤트
    $(document).on('click', '.viewPost', function(e) {
        e.preventDefault(); // 링크 기본 동작 방지

        const boardId = $(this).data('board-id'); // 게시글 ID
        // 비밀번호 입력 모달 열기
        $('#passwordModal').show();

        $('#submitPassword').off('click').on('click', function() {
            const password = $('#password').val();

            // 예시 비밀번호 설정 (서버에서 관리하는 실제 비밀번호와 비교해야 하지만 여기서는 예시로 사용)
            const correctPassword = '1234'; // 실제 비밀번호로 변경 필요

            // 비밀번호가 맞으면 게시글 상세보기로 이동, 틀리면 오류 메시지
            if (password === correctPassword) {
                // 비밀번호가 맞다면 상세 페이지로 이동
                window.location.href = `/boarddetail/${boardId}`;
            } else {
                // 비밀번호가 틀리면 오류 메시지
                $('#errorMessage').show();
                $('#password').val(''); // 비밀번호 입력 필드 초기화
            }
        });
    });

    // 페이징 이벤트 핸들러
        $('#paging').on('click', 'a', function (e) {
            e.preventDefault();
            page = parseInt($(this).data('page'));
            pagingList(page);
        });

        // 게시글 갯수 변경
        $('#limit').change(function () {
            limit = parseInt($(this).val());
            page = 1; // 페이지 번호 초기화
            pagingList(page);
        });

    // 서비스 다중 선택 처리
    let selectedServices = [];

    // 원하는 서비스 다중 선택 처리
    function selectOption(event, option) {
        const serviceButton = event.target; // 클릭된 버튼
        const serviceButtonText = serviceButton.textContent.trim(); // 버튼 텍스트(서비스 이름)

        // "공항픽업" 선택 시 다른 서비스 선택 불가능하게 처리
        if (option === 5) {
            // "공항픽업"을 선택한 경우
            if (!selectedServices.includes(5)) {
                // "공항픽업"이 선택되지 않았다면 배열 초기화
                selectedServices = [5];
                // 모든 버튼 비활성화 후 "공항픽업" 활성화
                document.querySelectorAll('.options button').forEach(button => {
                    button.classList.remove('selected');
                });
                serviceButton.classList.add('selected'); // "공항픽업" 버튼 스타일 변경
            } else {
                // 이미 "공항픽업" 선택 시 제거
                selectedServices = [];
                serviceButton.classList.remove('selected'); // "공항픽업" 선택 해제
            }
        } else {
            // 다른 서비스를 선택한 경우 "공항픽업"이 이미 선택되었는지 확인
            if (selectedServices.includes(5)) {
                alert("공항픽업을 선택한 경우 다른 서비스는 선택할 수 없습니다.");
                return; // 선택 취소
            }
        }

        // 선택된 서비스가 배열에 이미 있는지 확인
        const index = selectedServices.indexOf(option);

        if (index === -1) {
            // 선택되지 않은 경우, 배열에 추가
            selectedServices.push(option);
            serviceButton.classList.add('selected');  // 버튼 스타일 변경
        } else {
            // 이미 선택된 경우, 배열에서 삭제하지 않음
            serviceButton.classList.add('selected');  // 버튼 스타일 변경 (선택 상태로 유지)
        }

        // 선택된 서비스들을 화면에 표시 (삭제되지 않고 계속 누적)
        updateSelectedServices();
    }

    // '추가된 서비스'에서 클릭하면 해당 서비스 취소
    document.getElementById('anotherSelectedOption').addEventListener('click', function (event) {
        const clickedService = event.target;

        if (clickedService.classList.contains('remove-service')) {
            const serviceId = parseInt(clickedService.getAttribute('data-service'));

            // 해당 서비스가 배열에서 제거
            const index = selectedServices.indexOf(serviceId);
            if (index !== -1) {
                selectedServices.splice(index, 1);  // 배열에서 해당 옵션 제거
                // 버튼 스타일 변경
                const serviceButton = document.querySelector(`button[data-service="${serviceId}"]`);
                if (serviceButton) {
                    serviceButton.classList.remove('selected');
                }
            }

            // 다시 선택된 서비스들 화면에 반영
            updateSelectedServices();
        }
    });

    // 선택된 서비스 목록을 화면에 갱신
    function updateSelectedServices() {
        const anotherSelectedDiv = document.getElementById('anotherSelectedOption');

        // 화면에 표시할 서비스 이름 설정
        const serviceNames = {
            1: "산책",
            2: "목욕",
            3: "미용",
            4: "병원",
            5: "공항픽업",
        };

        // 선택된 서비스들을 화면에 표시 (다시 표시하도록)
        const selectedServiceHTML = selectedServices.map(id => {
            return `<span class="service">${serviceNames[id]} <button class="remove-service" data-service="${id}">×</button></span>`;
        }).join(', ');

        // 선택된 서비스들을 '추가된 서비스' 영역에만 표시
        anotherSelectedDiv.innerHTML = selectedServiceHTML;

        // 다중 선택된 서비스 값들을 숨겨진 input에 쉼표로 구분하여 저장
        document.getElementById('bService').value = selectedServices.join(',');

        // 선택된 서비스들 콘솔 출력
        console.log('선택된 서비스들:', selectedServices);

        // 선택된 반려견 이름 가져오기
        const petSelect = document.getElementById('petNum'); // 반려견 선택 드롭다운
        const petName = petSelect.options[petSelect.selectedIndex].text; // 선택된 옵션의 텍스트 (반려견 이름)

        // 제목 설정 로직
        let title = "";
        if (selectedServices.includes(5)) {
            title = `${petName}을 데려다 주세요!`;
        } else if (selectedServices.length > 0) {
            title = `${petName}과 시간을 보내요!`;
        }

        // 제목 입력 필드에 자동 입력
        document.getElementById('BTitle').value = title;
    }

    // 예약 시간 선택
    document.querySelectorAll('.options1 .option1').forEach(button => {
        button.addEventListener('click', function () {
            const option = this.getAttribute('data-option'); // data-option 속성 값 가져오기

            // 버튼을 모두 비활성화 상태로 초기화
            const buttons = document.querySelectorAll('.options1 .option1');
            buttons.forEach(button => {
                button.classList.remove('active');
            });

            // 선택된 버튼에 active 클래스 추가
            this.classList.add('active');

            // 선택된 시간 값을 hidden input에 설정
            document.getElementById('bTime').value = option;
            console.log('선택된 예약 시간:', option);
        });
    });

    // 날짜 달력 형식으로 표기
    document.addEventListener('DOMContentLoaded', function () {
        flatpickr("#Reservation_Date", {
            locale: "ko", // 한국어 설정
            dateFormat: "Y-m-d", // 날짜 형식
            minDate: "today", // 오늘 날짜 이후로만 선택 가능
            altInput: true, // 입력 필드에 달력 형식으로 보여주기
            altFormat: "Y F J", // 표시 형식
            allowInput: true, // 사용자 입력 가능
        });
    });

</script>

</html>